<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stat Point Allocator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f4f4f4;
            border-radius: 10px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        .stat-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-row label {
            font-weight: bold;
        }
        .stat-values {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stat-values input[type="number"] {
            width: 80px;
            padding: 5px;
            text-align: center;
        }
        .stat-values .current-stat {
            font-size: 1.2em;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        .add-buttons button {
            margin-left: 5px;
            padding: 5px 10px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .add-buttons button:hover {
            background-color: #e0e0e0;
        }
        .points-display {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            padding: 15px;
            background: #333;
            color: white;
            border-radius: 8px;
            margin-top: 10px;
        }
        #message-box {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            min-height: 20px;
            margin-top: 10px;
        }
        .msg-error { background-color: #ffdddd; color: #d8000c; }
        .msg-success { background-color: #ddffdd; color: #4f8a10; }
    </style>
</head>
<body>

    <div style="background: #333; padding: 10px 0; text-align: center; margin-bottom: 20px;">
        <a href="index.html" style="color: white; margin: 0 15px; text-decoration: none;">HP Calculator</a>
        <a href="stat-cap.html" style="color: white; margin: 0 15px; text-decoration: none;">Stat Cap Validator</a>
        <a href="stat-allocator.html" style="color: white; margin: 0 15px; text-decoration: none;">Stat Point Allocator</a>
        <a href="stat-growth.html" style="color: white; margin: 0 15px; text-decoration: none;">Stats For Level</a>
    </div>

    <div class="container">
        <h2 style="text-align:center;">Stat Point Allocator</h2>

        <div class="input-group">
            <div>
                <label for="free-points">Available Free Points:</label>
                <input type="number" id="free-points" value="100" style="width:100%; padding: 8px;">
            </div>
            <div>
                <label for="multiplier">Stat Cap Multiplier:</label>
                <input type="number" id="multiplier" value="1.5" step="0.01" style="width:100%; padding: 8px;">
            </div>
        </div>
        
        <div id="message-box"></div>
        
        <div class="points-display">
            Remaining Points: <span id="remaining-points">100</span>
        </div>

        <div class="stat-grid">
            <!-- Stat rows will be generated by JavaScript -->
        </div>
    </div>

    <script>
        const stats = [
            { id: 'str', name: 'Strength' },
            { id: 'sc', name: 'Shinsu Control' },
            { id: 'se', name: 'Shinsu Endurance' },
            { id: 'perc', name: 'Perception' },
            { id: 'will', name: 'Willpower' },
            { id: 'tech', name: 'Technique' },
            { id: 'insight', name: 'Insight' },
            { id: 'auth', name: 'Authority' }
        ];

        const statGrid = document.querySelector('.stat-grid');
        const freePointsInput = document.getElementById('free-points');
        const remainingPointsEl = document.getElementById('remaining-points');
        const messageBox = document.getElementById('message-box');

        // Initialize UI
        window.onload = () => {
            stats.forEach(stat => {
                const row = document.createElement('div');
                row.className = 'stat-row';
                row.innerHTML = `
                    <label for="${stat.id}">${stat.name}:</label>
                    <div class="stat-values">
                        <input type="number" id="${stat.id}" value="10" class="base-stat">
                        <span class="current-stat" id="${stat.id}-current">10</span>
                        <div class="add-buttons">
                            <button onclick="increaseStat('${stat.id}', 1)">+1</button>
                            <button onclick="increaseStat('${stat.id}', 5)">+5</button>
                            <button onclick="increaseStat('${stat.id}', 10)">+10</button>
                            <button onclick="increaseStat('${stat.id}', 25)">+25</button>
                            <button onclick="increaseStat('${stat.id}', 50)">+50</button>
                        </div>
                    </div>
                `;
                statGrid.appendChild(row);
            });
            
            updateFromInputs();

            freePointsInput.addEventListener('change', updateFromInputs);
            document.querySelectorAll('.base-stat').forEach(input => {
                input.addEventListener('change', updateFromInputs);
            });
        };

        function updateFromInputs() {
            remainingPointsEl.textContent = freePointsInput.value;
            stats.forEach(stat => {
                const baseValue = document.getElementById(stat.id).value;
                document.getElementById(`${stat.id}-current`).textContent = baseValue;
            });
            clearMessage();
        }

        function getCost(statValue) {
            if (statValue <= 49) return 1;
            if (statValue <= 99) return 2;
            if (statValue <= 149) return 3;
            if (statValue <= 199) return 4;
            if (statValue <= 249) return 5;
            if (statValue <= 299) return 7;
            if (statValue <= 349) return 10;
            if (statValue <= 399) return 12;
            if (statValue <= 449) return 15;
            return 20; // 450+
        }

        function showMessage(text, type = 'error') {
            messageBox.textContent = text;
            messageBox.className = type === 'error' ? 'msg-error' : 'msg-success';
        }

        function clearMessage() {
            messageBox.textContent = '';
            messageBox.className = '';
        }

        function increaseStat(statId, amount) {
            clearMessage();
            let remainingPoints = parseInt(remainingPointsEl.textContent);
            const multiplier = parseFloat(document.getElementById('multiplier').value);
            const statCurrentEl = document.getElementById(`${statId}-current`);

            for (let i = 0; i < amount; i++) {
                let currentStatValues = {};
                let statSum = 0;
                let statCount = 0;

                stats.forEach(s => {
                    const val = parseInt(document.getElementById(`${s.id}-current`).textContent);
                    currentStatValues[s.id] = val;
                    statSum += val;
                    statCount++;
                });

                const average = statSum / statCount;
                const cap = average * multiplier;
                
                const targetStatValue = currentStatValues[statId];

                if (targetStatValue + 1 > cap) {
                    showMessage(`Cannot increase ${stats.find(s=>s.id===statId).name}. It would exceed the stat cap of ${cap.toFixed(2)}.`);
                    return;
                }

                const cost = getCost(targetStatValue);

                if (remainingPoints < cost) {
                    showMessage("Not enough remaining points.");
                    return;
                }

                remainingPoints -= cost;
                currentStatValues[statId]++;

                // Update UI after a successful point allocation
                statCurrentEl.textContent = currentStatValues[statId];
                remainingPointsEl.textContent = remainingPoints;
            }
        }
    </script>
</body>
</html>
